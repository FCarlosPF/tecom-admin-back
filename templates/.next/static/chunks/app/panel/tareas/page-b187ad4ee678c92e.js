(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[758],{38553:(e,a,r)=>{Promise.resolve().then(r.bind(r,2575))},2575:(e,a,r)=>{"use strict";r.d(a,{default:()=>b});var t=r(95155),l=r(12115),s=r(11536),i=r(41938),o=r(57798),d=r(52798);let n=e=>{let{isOpen:a,onClose:r,newTask:s,setNewTask:o,handleAddTask:n,tareas:c,usuarioLogeado:m,empleados:u}=e,[x,h]=(0,l.useState)([]),[p,g]=(0,l.useState)(""),{proyectos:y}=(0,i.A)();if((0,l.useEffect)(()=>{if(s.tarea_padre){let e=Array.isArray(c)?c.find(e=>1===m.rol?e.tarea_id===parseInt(s.tarea_padre,10):e.tarea.tarea_id===parseInt(s.tarea_padre,10)):null;e&&g(1===m.rol?e.fecha_estimada_fin:e.tarea.fecha_estimada_fin)}else g("")},[s.tarea_padre,c,null==m?void 0:m.rol]),!a)return null;let f=e=>{let a=parseInt(e.target.value,10);h(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a])};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-end items-start",onClick:r,children:(0,t.jsxs)("div",{className:"bg-gray-200 p-6 rounded-l-lg shadow-2xl w-full md:w-1/3 lg:w-1/4 h-full overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Agregar Tarea"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"T\xedtulo"}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 border rounded shadow-inner",value:s.titulo,onChange:e=>o({...s,titulo:e.target.value})})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Descripci\xf3n"}),(0,t.jsx)("textarea",{className:"w-full p-2 border rounded",value:s.descripcion,onChange:e=>o({...s,descripcion:e.target.value})})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Proyecto"}),(0,t.jsxs)("select",{className:"w-full p-2 border rounded",value:s.proyecto_id||"",onChange:e=>o({...s,proyecto_id:Number(e.target.value)}),children:[(0,t.jsx)("option",{value:"",children:"Seleccione un proyecto"}),Array.isArray(y)&&y.map(e=>(0,t.jsx)("option",{value:e.proyecto_id,children:e.nombre},e.proyecto_id))]})]}),m&&(1===m.rol||2===m.rol)&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Tarea Padre"}),(0,t.jsxs)("select",{className:"w-full p-2 border rounded",value:s.tarea_padre||"",onChange:e=>o({...s,tarea_padre:e.target.value}),children:[(0,t.jsx)("option",{value:"",children:"Seleccione una tarea padre"}),Array.isArray(c)&&c.map(e=>(0,t.jsx)("option",{value:2===m.rol?e.tarea.tarea_id:e.tarea_id,children:2===m.rol?e.tarea.titulo:e.titulo},2===m.rol?e.tarea.tarea_id:e.tarea_id))]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Fecha Estimada de Fin"}),(0,t.jsx)("input",{type:"datetime-local",value:s.fecha_estimada_fin?(0,d.GP)(new Date(s.fecha_estimada_fin),"yyyy-MM-dd'T'HH:mm"):"",min:(()=>{let e=new Date;return(0,d.GP)(e,"yyyy-MM-dd'T'HH:mm")})(),max:p?(0,d.GP)(new Date(p),"yyyy-MM-dd'T'HH:mm"):"",onChange:e=>o(a=>({...a,fecha_estimada_fin:new Date(e.target.value).toISOString()})),className:"mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Prioridad"}),(0,t.jsxs)("select",{value:s.prioridad,onChange:e=>o(a=>({...a,prioridad:e.target.value})),className:"p-2 rounded-md shadow-inner border",children:[(0,t.jsx)("option",{value:"",disabled:!0,children:"Selecciona Prioridad"}),(0,t.jsx)("option",{value:"Alta",children:"Alta"}),(0,t.jsx)("option",{value:"Media",children:"Media"}),(0,t.jsx)("option",{value:"Baja",children:"Baja"})]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Asignar a Usuarios"}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-2 max-h-48 overflow-y-auto",children:Array.isArray(u)&&u.map(e=>(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",value:e.id_empleado,checked:x.includes(e.id_empleado),onChange:f,className:"mr-2"}),e.nombre]},e.id_empleado))})]}),(0,t.jsxs)("div",{className:"flex gap-4 justify-end",children:[(0,t.jsx)("button",{className:"px-4 py-2 bg-gray-200 rounded-md shadow-lg hover:shadow-xl transition",onClick:r,children:"Cancelar"}),(0,t.jsx)("button",{className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md shadow-lg hover:shadow-xl transition",onClick:()=>{n(x)},children:"Agregar"})]})]})})},c=e=>{let{prioridad:a}=e;return(0,t.jsx)("div",{className:"w-6 h-6 rounded-full shadow-md ".concat({Alta:"bg-red-500",Media:"bg-yellow-500",Baja:"bg-green-500"}[a]," flex items-center justify-center text-white font-bold"),title:a})},m=e=>{let{estado:a}=e;return(0,t.jsx)("div",{className:"w-full h-6 rounded-full shadow-md ".concat({Pendiente:"bg-yellow-500","En Progreso":"bg-blue-500",Programada:"bg-gray-500",Completada:"bg-green-500"}[a]," flex items-center justify-center text-white font-bold"),title:a,children:a})},u=e=>{let{tareas:a,usuarioLogeado:r,eliminarTarea:l,editarTarea:i}=e,o=["T\xedtulo","Descripci\xf3n","Prioridad","Estado","Fecha Inicio","Fecha Estimada Fin","Fecha Fin"];r&&(1===r.rol||2===r.rol)&&o.push("Acciones");let n=e=>{try{return(0,d.GP)(new Date(e),"dd/MM/yyyy HH:mm")}catch(a){return console.error("Invalid date:",e),"Fecha inv\xe1lida"}};return(0,t.jsxs)("table",{className:"w-full rounded-lg",children:[(0,t.jsx)("thead",{className:"bg-gray-800",children:(0,t.jsx)("tr",{children:o.map(e=>(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm text-white font-bold",children:e},e))})}),(0,t.jsx)("tbody",{children:a.map(e=>{let a=r&&1===r.rol?e:e.tarea;return(0,t.jsxs)("tr",{className:"hover:bg-gray-700 transition",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-100",children:a.titulo}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-100",children:a.descripcion}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-100 flex justify-center",children:(0,t.jsx)(c,{prioridad:a.prioridad})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-100",children:(0,t.jsx)(m,{estado:a.estado})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-100",children:a.fecha_inicio?n(a.fecha_inicio):"Fecha inv\xe1lida"}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-100",children:a.fecha_estimada_fin?n(a.fecha_estimada_fin):"Fecha inv\xe1lida"}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-100",children:a.fecha_real_fin?n(a.fecha_real_fin):""}),r&&(1===r.rol||2===r.rol)&&(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-100",children:(0,t.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,t.jsx)("button",{className:"text-blue-500 hover:text-blue-700 transition",onClick:()=>i(a),children:(0,t.jsx)(s.uO9,{})}),1===r.rol&&(0,t.jsx)("button",{className:"text-red-500 hover:text-red-700 transition",onClick:()=>l(a.tarea_id),children:(0,t.jsx)(s.qbC,{})})]})})]},a.tarea_id)})})]})},x=e=>{let{currentPage:a,totalPages:r,paginate:l}=e;return(0,t.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,t.jsx)("button",{className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md shadow-md hover:shadow-neu-active transition",onClick:()=>l(a-1),disabled:1===a,children:(0,t.jsx)(s.QVr,{})}),(0,t.jsx)("button",{className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md shadow-md hover:shadow-neu-active transition",onClick:()=>l(a+1),disabled:a===r,children:(0,t.jsx)(s.Z0P,{})})]})};var h=r(91068),p=r(54228),g=r(91880);function y(e,a){var r,t;let l=(0,g.a)(e,null==a?void 0:a.in);if(isNaN(+l))throw RangeError("Invalid time value");let s=null!==(r=null==a?void 0:a.format)&&void 0!==r?r:"extended",i=null!==(t=null==a?void 0:a.representation)&&void 0!==t?t:"complete",o="",d="",n="extended"===s?"-":"";if("time"!==i){let e=(0,p.F)(l.getDate(),2),a=(0,p.F)(l.getMonth()+1,2),r=(0,p.F)(l.getFullYear(),4);o="".concat(r).concat(n).concat(a).concat(n).concat(e)}if("date"!==i){let e=l.getTimezoneOffset();if(0!==e){let a=Math.abs(e),r=(0,p.F)(Math.trunc(a/60),2),t=(0,p.F)(a%60,2);d="".concat(e<0?"+":"-").concat(r,":").concat(t)}else d="Z";let a=(0,p.F)(l.getHours(),2),r=(0,p.F)(l.getMinutes(),2),t=(0,p.F)(l.getSeconds(),2),i=""===o?"":"T",n=[a,r,t].join("extended"===s?":":"");o="".concat(o).concat(i).concat(n).concat(d)}return o}let f=e=>{let{isOpen:a,onClose:r,taskToEdit:s,handleEditTask:o,tareas:n,usuarioLogeado:c,empleados:m,asignacionesTareas:u}=e,[x,h]=(0,l.useState)(s||{}),[p,g]=(0,l.useState)([]),{proyectos:y}=(0,i.A)();if((0,l.useEffect)(()=>{s&&(h(s),g(u.filter(e=>e.tarea.tarea_id===s.tarea_id).map(e=>e.empleado.id_empleado)),s.proyecto&&s.proyecto.proyecto_id&&h(e=>({...e,proyecto_id:s.proyecto.proyecto_id})))},[s,u]),!a)return null;let f=e=>{let a=parseInt(e.target.value,10);g(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a])};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-end items-start",onClick:r,children:(0,t.jsxs)("div",{className:"bg-gray-200 p-6 rounded-l-lg shadow-2xl w-full md:w-1/3 lg:w-1/4 h-full overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Editar Tarea"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"T\xedtulo"}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 border rounded shadow-inner",value:x.titulo||"",onChange:e=>h({...x,titulo:e.target.value})})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Descripci\xf3n"}),(0,t.jsx)("textarea",{className:"w-full p-2 border rounded",value:x.descripcion||"",onChange:e=>h({...x,descripcion:e.target.value})})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Proyecto"}),(0,t.jsxs)("select",{className:"w-full p-2 border rounded",value:x.proyecto_id||"",onChange:e=>h({...x,proyecto_id:Number(e.target.value)}),children:[(0,t.jsx)("option",{value:"",children:"Seleccione un proyecto"}),Array.isArray(y)&&y.map(e=>(0,t.jsx)("option",{value:e.proyecto_id,children:e.nombre},e.proyecto_id))]})]}),c&&(1===c.rol||2===c.rol)&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Tarea Padre"}),(0,t.jsxs)("select",{className:"w-full p-2 border rounded",value:x.tarea_padre||"",onChange:e=>h({...x,tarea_padre:e.target.value}),children:[(0,t.jsx)("option",{value:"",children:"Seleccione una tarea padre"}),Array.isArray(n)&&n.map(e=>(0,t.jsx)("option",{value:2===c.rol?e.tarea.tarea_id:e.tarea_id,children:2===c.rol?e.tarea.titulo:e.titulo},2===c.rol?e.tarea.tarea_id:e.tarea_id))]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Fecha Estimada de Fin"}),(0,t.jsx)("input",{type:"datetime-local",value:x.fecha_estimada_fin?(0,d.GP)(new Date(x.fecha_estimada_fin),"yyyy-MM-dd'T'HH:mm"):"",min:(()=>{let e=new Date;return(0,d.GP)(e,"yyyy-MM-dd'T'HH:mm")})(),onChange:e=>h(a=>({...a,fecha_estimada_fin:new Date(e.target.value).toISOString()})),className:"mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Prioridad"}),(0,t.jsxs)("select",{value:x.prioridad||"",onChange:e=>h(a=>({...a,prioridad:e.target.value})),className:"p-2 rounded-md shadow-inner border",children:[(0,t.jsx)("option",{value:"",disabled:!0,children:"Selecciona Prioridad"}),(0,t.jsx)("option",{value:"Alta",children:"Alta"}),(0,t.jsx)("option",{value:"Media",children:"Media"}),(0,t.jsx)("option",{value:"Baja",children:"Baja"})]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-gray-700",children:"Asignar a Usuarios"}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-2 max-h-48 overflow-y-auto",children:Array.isArray(m)&&m.map(e=>(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",value:e.id_empleado,checked:p.includes(e.id_empleado),onChange:f,className:"mr-2"}),e.nombre]},e.id_empleado))})]}),(0,t.jsxs)("div",{className:"flex gap-4 justify-end",children:[(0,t.jsx)("button",{className:"px-4 py-2 bg-gray-200 rounded-md shadow-lg hover:shadow-xl transition",onClick:r,children:"Cancelar"}),(0,t.jsx)("button",{className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md shadow-lg hover:shadow-xl transition",onClick:()=>{o(x,p)},children:"Guardar"})]})]})})},b=()=>{let{tareas:e,setTareas:a,usuarioLogeado:r,setUsuarioLogeado:d,empleados:c,setEmpleados:m,asignacionesTareas:p,setAsignacionesTareas:g,setProyectos:b}=(0,i.A)(),[j,v]=(0,l.useState)(!0),[_,N]=(0,l.useState)(!1),[w,k]=(0,l.useState)(!1),[C,A]=(0,l.useState)(null),[P,T]=(0,l.useState)({titulo:"",descripcion:"",fecha_inicio:y(new Date),fecha_estimada_fin:"",prioridad:"",estado:"Pendiente",tarea_padre:null,proyecto_id:""}),[E,F]=(0,l.useState)(1),M=async()=>{try{v(!0);let[e,t,l]=await Promise.all([1===r.rol?(0,o.C)():(0,o.bC)(r.id_empleado),(0,o.Lr)(),(0,o.T8)()]);a(e),g(t),m(l)}catch(e){console.error("Error al realizar los fetch:",e.message,e.stack)}finally{v(!1)}};(0,l.useEffect)(()=>{r&&null!==r.id_empleado?M():console.log("usuarioLogeado no est\xe1 definido o id_empleado es null")},[r]),(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,o.DX)();console.log("Fetched proyectos",e),Array.isArray(e)&&b(e)}catch(e){console.error("Error fetching data:",e)}})()},[]);let S=async e=>{try{await (0,o.pf)(e),a(a=>a.filter(a=>a.id!==e)),M()}catch(e){console.error("Error al eliminar la tarea:",e)}},D=async e=>{try{let t={...P,estado:"Pendiente"};console.log("Enviando a la API:",t);let l=await (0,o.XZ)(t);if(console.log("Tarea a\xf1adida:",l),l&&l.tarea_id){if(a(e=>[...e,l]),r&&2===r.rol){let e=l.tarea_id,a=r.id_empleado;await I({tarea:e,empleado:a,asignador:r.id_empleado})}if(e.length>0)for(let a of e)await I({tarea:l.tarea_id,empleado:a,asignador:r.id_empleado})}else console.error("La tarea a\xf1adida no contiene un id:",l);T({titulo:"",descripcion:"",fecha_inicio:y(new Date),fecha_estimada_fin:"",prioridad:"",estado:"Pendiente",tarea_padre:null,proyecto_id:""}),M(),N(!1)}catch(e){console.error("Error al agregar la tarea:",e)}},H=async(t,l)=>{try{console.log("Editando tarea:",t),await (0,o.QW)(t.tarea_id,t),console.log("Tarea actualizada:",t);let s=p.filter(e=>e.tarea.tarea_id===t.tarea_id).map(e=>({asignacion_id:e.asignacion_id,userId:e.empleado.id_empleado}));console.log("currentAssignments",s),await Promise.all(l.map(async e=>{s.some(a=>a.userId===e)||await I({tarea:t.tarea_id,empleado:e,asignador:r.id_empleado})})),await Promise.all(s.map(async e=>{let{asignacion_id:a,userId:r}=e;l.includes(r)||await (0,o.qK)(a)})),a(e=>e.map(e=>e.tarea_id===t.tarea_id?t:e)),console.log(e),M(),h.oR.success("Tarea editada correctamente"),k(!1)}catch(e){console.error("Error al editar la tarea:",e),h.oR.error("Error al editar la tarea")}},I=async(e,a,r)=>{try{console.log("Asignando tarea:",{taskId:e,userId:a,asignador:r}),await (0,o.ZI)(e,a,r),M(),h.oR.success("Tarea asignada correctamente"),console.log("Tarea asignada correctamente")}catch(e){console.error("Error al asignar la tarea:",e)}},L=10*E,O=Array.isArray(e)?e.slice(L-10,L):[];return j?(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:"Cargando..."}):(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"p-6 bg-gray-100 min-h-screen",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold text-gray-800",children:"Historial de Tareas"}),r&&(1===r.rol||2===r.rol)&&(0,t.jsx)("div",{className:"flex gap-4",children:(0,t.jsx)("button",{className:"p-2 bg-gray-800 text-white rounded-full shadow-lg flex items-center hover:shadow-xl transition",onClick:()=>N(!0),children:(0,t.jsx)(s.OiG,{})})})]}),(0,t.jsxs)("div",{className:"bg-gray-900  p-6 rounded-lg",children:[(0,t.jsx)(u,{tareas:O,usuarioLogeado:r,eliminarTarea:S,editarTarea:e=>{A(e),k(!0)}}),(0,t.jsx)(x,{currentPage:E,totalPages:Math.ceil(e.length/10),paginate:F})]}),r&&(1===r.rol||2===r.rol)&&(0,t.jsx)("div",{className:"flex justify-end mt-4",children:(0,t.jsx)("button",{className:"p-2 bg-blue-600 text-white rounded-full shadow-lg flex items-center hover:shadow-xl transition",onClick:o.tt,children:"Descargar Reporte"})})]}),(0,t.jsx)(n,{isOpen:_,onClose:()=>N(!1),newTask:P,setNewTask:T,handleAddTask:D,tareas:e,usuarioLogeado:r,empleados:c}),(0,t.jsx)(f,{isOpen:w,onClose:()=>k(!1),taskToEdit:C,handleEditTask:H,tareas:e,usuarioLogeado:r,empleados:c,asignacionesTareas:p})]})})}},41938:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=(0,r(99827).v)(e=>({usuarioLogeado:{id_empleado:null,nombre:"",apellidos:"",correo:"",especialidad:"",sueldo:"",activo:!1,foto:"",nombre_usuario:"",fecha_contratacion:"",area:null,rol:null},empleados:[],tareas:[],asignacionesTareas:[],proyectos:[],notificaciones:[],setUsuarioLogeado:a=>e({usuarioLogeado:a}),setEmpleados:a=>e({empleados:a}),setTareas:a=>e({tareas:a}),setAsignacionesTareas:a=>e({asignacionesTareas:a}),setProyectos:a=>e({proyectos:a}),setNotificaciones:a=>e({notificaciones:a})}))}},e=>{var a=a=>e(e.s=a);e.O(0,[711,560,466,798,441,517,358],()=>a(38553)),_N_E=e.O()}]);