(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[307],{46800:(e,a,t)=>{Promise.resolve().then(t.bind(t,65183))},65183:(e,a,t)=>{"use strict";t.d(a,{default:()=>x});var s=t(95155),r=t(12115),l=t(11536),o=t(41938),i=t(57798),n=t(52798);let c=e=>{let{isOpen:a,onClose:t}=e,[l,n]=(0,r.useState)([]),{usuarioLogeado:c}=(0,o.A)();return((0,r.useEffect)(()=>{a&&(async()=>{try{let e=await (0,i.X9)(c.id_empleado);n(e)}catch(e){console.error("Error al obtener las notificaciones:",e)}})()},[a,null==c?void 0:c.id_empleado]),a)?(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-75 flex justify-end",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-1/4 h-full overflow-y-auto relative",children:[(0,s.jsx)("button",{className:"absolute top-0 right-0 m-4 text-3xl",onClick:t,children:"\xd7"}),(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Notificaciones"}),(0,s.jsx)("div",{className:"space-y-4",children:l.map(e=>(0,s.jsxs)("div",{className:"bg-gray-100 p-4 rounded-lg shadow-md",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:e.titulo_notificacion}),(0,s.jsx)("p",{children:e.descripcion_notificacion}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:new Date(e.fecha_evento).toLocaleString()})]},e.id_notificacion))})]})}):null},d=e=>{let{selectedTarea:a,asignadorNombres:t,empleadoNombres:r,closeModal:o,handleOutsideClick:i}=e;return a&&(0,s.jsx)("div",{id:"modal-overlay",className:"fixed inset-0 bg-black bg-opacity-50 flex justify-end items-start",onClick:i,children:(0,s.jsxs)("div",{className:"w-[25%] md:w-[30%] lg:w-[25%] h-full bg-white shadow-2xl rounded-l-lg p-6 relative z-50 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{className:"absolute top-4 right-4 text-gray-600 hover:text-red-500 text-3xl",onClick:o,children:"\xd7"}),(0,s.jsx)("h2",{className:"text-3xl font-bold mb-6 text-gray-800",children:a.titulo}),(0,s.jsx)("p",{className:"text-gray-600 mb-6 text-base leading-relaxed",children:a.descripcion}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center text-base text-gray-600",children:[(0,s.jsx)(l.w_X,{className:"mr-2 text-blue-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Fecha de inicio:"})," ",(0,s.jsx)("span",{className:"ml-1",children:(0,n.GP)(new Date(a.fecha_inicio),"dd/MM/yyyy HH:mm")})]}),(0,s.jsxs)("div",{className:"flex items-center text-base text-gray-600",children:[(0,s.jsx)(l.w_X,{className:"mr-2 text-blue-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Fecha estimada de fin:"})," ",(0,s.jsx)("span",{className:"ml-1",children:(0,n.GP)(new Date(a.fecha_estimada_fin),"dd/MM/yyyy HH:mm")})]}),a.fecha_real_fin&&(0,s.jsxs)("div",{className:"flex items-center text-base text-gray-600",children:[(0,s.jsx)(l.w_X,{className:"mr-2 text-green-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Fecha real de fin:"})," ",(0,s.jsx)("span",{className:"ml-1",children:(0,n.GP)(new Date(a.fecha_real_fin),"dd/MM/yyyy HH:mm")})]}),(0,s.jsxs)("div",{className:"flex items-center text-base text-gray-600",children:[(0,s.jsx)(l.wJQ,{className:"mr-2 text-yellow-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Prioridad:"})," ",(0,s.jsx)("span",{className:"ml-1",children:a.prioridad})]}),(0,s.jsxs)("div",{className:"flex items-center text-base text-gray-600",children:[(0,s.jsx)(l.x$1,{className:"mr-2 text-purple-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Asignador:"})," ",(0,s.jsx)("span",{className:"ml-1",children:t})]}),(0,s.jsxs)("div",{className:"flex items-center text-base text-gray-600",children:[(0,s.jsx)(l.x$1,{className:"mr-2 text-purple-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Empleado:"})," ",(0,s.jsx)("span",{className:"ml-1",children:r})]}),(0,s.jsxs)("div",{className:"flex items-center text-base text-gray-600",children:[(0,s.jsx)(l.w_X,{className:"mr-2 text-teal-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Tiempo restante:"})," ",(0,s.jsxs)("span",{className:"ml-1",children:[a.tiempo_restante.dias," d\xedas,"," ",a.tiempo_restante.horas," horas,"," ",a.tiempo_restante.minutos," minutos"]})]}),(0,s.jsxs)("div",{className:"flex items-center text-base text-gray-600",children:[(0,s.jsx)(l.w_X,{className:"mr-2 text-red-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Tiempo pasado:"})," ",(0,s.jsxs)("span",{className:"ml-1",children:[a.tiempo_pasado.dias," d\xedas,"," ",a.tiempo_pasado.horas," horas,"," ",a.tiempo_pasado.minutos," minutos"]})]})]})]})})},m=e=>{let{estados:a,tareasPorEstado:t,usuarioLogeado:r,tareas:o,handleCardClick:i,completarTarea:c,toggleExpand:d,expandedTareas:m}=e;return(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 h-full flex-grow",children:a.map(e=>(0,s.jsxs)("div",{className:"bg-gray-900 p-2 rounded-lg shadow-md flex flex-col h-full overflow-y-auto",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white mb-2",children:e}),(0,s.jsx)("div",{className:"flex flex-col space-y-2",children:t[e]&&t[e].length>0?t[e].filter(e=>r&&1==r.rol?!e.tarea_padre:!e.tarea.tarea_padre).map(e=>{let a=o.filter(a=>r&&1===r.rol?a.tarea_padre===e.tarea_id:a.tarea.tarea_padre===e.tarea.tarea_id),t=r&&1===r.rol?e:e.tarea;return(0,s.jsxs)("div",{className:"bg-gray-800 shadow-md rounded-lg overflow-hidden p-2 border-l-4 border-blue-500 cursor-pointer",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",onClick:()=>1===r.rol?i(e):i(e.tarea),children:[(0,s.jsxs)("div",{className:"flex-grow",children:[(0,s.jsx)("div",{className:"flex justify-between items-center mb-1",children:(0,s.jsx)("h2",{className:"text-base font-semibold text-white",children:t.titulo})}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:t.descripcion}),(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-400 mb-1",children:[(0,s.jsx)(l.w_X,{className:"mr-1 text-blue-500"}),(0,s.jsx)("span",{className:"Completada"!==t.estado&&0===t.tiempo_restante.dias&&0===t.tiempo_restante.horas||"Completada"===t.estado&&new Date(t.fecha_real_fin)>new Date(t.fecha_estimada_fin)?"text-red-500":"",children:"Completada"===t.estado?"Completada el: ".concat((0,n.GP)(new Date(t.fecha_real_fin),"dd/MM/yyyy HH:mm")):0===t.tiempo_restante.dias&&0===t.tiempo_restante.horas?"Vencido: ".concat(t.tiempo_pasado.dias," d\xedas y ").concat(t.tiempo_pasado.horas," horas pasados"):"Tiempo restante: ".concat(t.tiempo_restante.dias," d\xedas y ").concat(t.tiempo_restante.horas," horas")})]}),(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-400 mb-1",children:[(0,s.jsx)(l.wJQ,{className:"mr-1 text-yellow-500"}),(0,s.jsx)("span",{children:t.prioridad})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:["Completada"!==t.estado&&(0,s.jsx)("button",{className:"flex items-center justify-center w-6 h-6 text-white rounded-full shadow-md transition-colors duration-300 ".concat("Pendiente"===t.estado?"bg-blue-500 hover:bg-blue-600":"bg-green-500 hover:bg-green-600"),onClick:a=>{a.stopPropagation(),c(r&&1==r.rol?e.tarea_id:e.tarea.tarea_id)},children:"Pendiente"===t.estado?(0,s.jsx)(l.Z0P,{size:12}):(0,s.jsx)(l.CMH,{size:12})}),a.length>0&&(0,s.jsx)("button",{className:"ml-2 text-gray-400 hover:text-gray-200",onClick:a=>{a.stopPropagation(),d(1===r.rol?e.tarea_id:e.tarea.tarea_id)},children:m[1===r.rol?e.tarea_id:e.tarea.tarea_id]?(0,s.jsx)(l.Ucs,{}):(0,s.jsx)(l.Vr3,{})})]})]}),m[r&&1===r.rol?e.tarea_id:e.tarea.tarea_id]&&(0,s.jsx)("div",{className:"pl-4 mt-2",children:a.map(e=>{let a=1===r.rol?e:e.tarea;return(0,s.jsx)("div",{className:"bg-gray-700 shadow-md rounded-lg overflow-hidden p-2 border-l-4 border-indigo-500 cursor-pointer",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",onClick:()=>i(a),children:[(0,s.jsxs)("div",{className:"flex-grow",children:[(0,s.jsx)("div",{className:"flex justify-between items-center mb-1",children:(0,s.jsx)("h2",{className:"text-base font-semibold text-white",children:a.titulo})}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:a.descripcion}),(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-400 mb-1",children:[(0,s.jsx)(l.w_X,{className:"mr-1 text-blue-500"}),(0,s.jsx)("span",{children:"Completada"===a.estado?"Completada el: ".concat((0,n.GP)(new Date(a.fecha_real_fin),"dd/MM/yyyy HH:mm")):0===a.tiempo_restante.dias&&0===a.tiempo_restante.horas?"Vencido: ".concat(a.tiempo_pasado.dias," d\xedas y ").concat(a.tiempo_pasado.horas," horas pasados"):"Tiempo restante: ".concat(a.tiempo_restante.dias," d\xedas y ").concat(a.tiempo_restante.horas," horas")})]}),(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-400 mb-1",children:[(0,s.jsx)(l.wJQ,{className:"mr-1 text-yellow-500"}),(0,s.jsx)("span",{children:a.prioridad})]})]}),(0,s.jsx)("div",{className:"flex items-center",children:"Completada"!==a.estado&&(0,s.jsx)("button",{className:"flex items-center justify-center w-6 h-6 text-white rounded-full shadow-md transition-colors duration-300 ".concat("Pendiente"===a.estado?"bg-blue-500 hover:bg-blue-600":"bg-green-500 hover:bg-green-600"),onClick:a=>{a.stopPropagation(),c(e.tarea_id)},children:"Pendiente"===a.estado?(0,s.jsx)(l.Z0P,{size:12}):(0,s.jsx)(l.CMH,{size:12})})})]})},a.tarea_id)})})]},t.tarea_id)}):(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No hay tareas en este estado."})})]},e))})},x=()=>{let{tareas:e,setTareas:a,usuarioLogeado:t,setEmpleados:x,setAsignacionesTareas:p,asignacionesTareas:u}=(0,o.A)(),[h,f]=(0,r.useState)(!0),[y,j]=(0,r.useState)(null),[g,b]=(0,r.useState)(""),[N,v]=(0,r.useState)(""),[_,w]=(0,r.useState)({}),[P,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=async()=>{try{let e=await (0,i.Lr)();Array.isArray(e)?p(e):console.error("La respuesta de la API no es un array:",e)}catch(e){console.error("Error al obtener las asignaciones de tareas:",e)}};(async()=>{try{let e=await (0,i.T8)();Array.isArray(e)?x(e):console.error("La respuesta de la API no es un array:",e)}catch(e){console.error("Error al obtener los usuarios:",e)}})(),e()},[x,p]),(0,r.useEffect)(()=>{t&&O()},[t]),(0,r.useEffect)(()=>{console.log("Tareas:",e)},[e]);let O=async()=>{if(!t){console.error("usuarioLogeado no est\xe1 definido"),a([]),f(!1);return}if(null===t.id_empleado){console.log("id_empleado es null, no se ejecuta fetchTareas"),f(!1);return}try{let e;if(1===t.rol)e=await (0,i.C)();else{if(!t.id_empleado){console.error("id_empleado no est\xe1 definido en usuarioLogeado"),a([]),f(!1);return}e=await (0,i.bC)(t.id_empleado)}a(Array.isArray(e)?e:[])}catch(e){console.error("Error al obtener las tareas:",e.message,e.stack),a([])}finally{f(!1)}},E=async s=>{try{let r=e.find(e=>1===t.rol?e.tarea_id===s:e.asignacion_id===s);if(!r)throw Error("Tarea no encontrada");let l=1===t.rol?r.estado:r.tarea.estado,o="Pendiente"===l?"En Progreso":"Completada",c="Completada"===o?(0,n.GP)(new Date,"yyyy-MM-dd'T'HH:mm:ss.SSSxxx"):null;1===t.rol?await (0,i.QW)(s,{...r,estado:o,fecha_real_fin:c}):await (0,i.aJ)(s,{tarea:{...r.tarea,estado:o,fecha_real_fin:c}}),a(e=>e.map(e=>(1===t.rol?e.tarea_id:e.asignacion_id)===s?{...e,estado:o}:e)),O()}catch(e){console.error("Error al completar la tarea:",e)}},k=()=>{j(null),b(""),v("")};if(h)return(0,s.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,s.jsx)("p",{className:"text-lg text-gray-600 animate-pulse",children:"Cargando..."})});let T=(Array.isArray(e)?e:[]).reduce((e,a)=>{var s;let r=t&&1===t.rol?a.estado:null===(s=a.tarea)||void 0===s?void 0:s.estado;return e[r]||(e[r]=[]),e[r].push(a),e},{});return(0,s.jsxs)("div",{className:"container mx-auto p-6 h-screen flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("div",{className:"flex-grow text-center",children:(0,s.jsx)("h1",{className:"text-4xl font-bold text-black",children:"Panel de Tareas"})}),(0,s.jsx)(l.jNV,{className:"text-4xl text-black cursor-pointer",onClick:()=>{C(!0)}})]}),(0,s.jsx)(m,{estados:["Pendiente","En Progreso","Completada"],tareasPorEstado:T,usuarioLogeado:t,tareas:e,handleCardClick:e=>{console.log("Tarea seleccionada:",e),j(e);let a=u.filter(a=>a.tarea.tarea_id===e.tarea_id);b([...new Set(a.map(e=>e.asignador.nombre))].join(", ")),v(a.map(e=>{var a;return null===(a=e.empleado)||void 0===a?void 0:a.nombre}).join(", "))},completarTarea:E,toggleExpand:e=>{w(a=>({...a,[e]:!a[e]}))},expandedTareas:_}),(0,s.jsx)(d,{selectedTarea:y,asignadorNombres:g,empleadoNombres:N,closeModal:k,handleOutsideClick:e=>{"modal-overlay"===e.target.id&&k()}}),(0,s.jsx)(c,{isOpen:P,onClose:()=>{C(!1)}})]})}},41938:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(99827).v)(e=>({usuarioLogeado:{id_empleado:null,nombre:"",apellidos:"",correo:"",especialidad:"",sueldo:"",activo:!1,foto:"",nombre_usuario:"",fecha_contratacion:"",area:null,rol:null},empleados:[],tareas:[],asignacionesTareas:[],proyectos:[],notificaciones:[],setUsuarioLogeado:a=>e({usuarioLogeado:a}),setEmpleados:a=>e({empleados:a}),setTareas:a=>e({tareas:a}),setAsignacionesTareas:a=>e({asignacionesTareas:a}),setProyectos:a=>e({proyectos:a}),setNotificaciones:a=>e({notificaciones:a})}))},93435:(e,a,t)=>{"use strict";t.d(a,{k5:()=>d});var s=t(12115),r={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},l=s.createContext&&s.createContext(r),o=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e}).apply(this,arguments)}function n(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,s)}return t}function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?n(Object(t),!0).forEach(function(a){var s,r;s=a,r=t[a],(s=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,a||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(s))in e?Object.defineProperty(e,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[s]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})}return e}function d(e){return a=>s.createElement(m,i({attr:c({},e.attr)},a),function e(a){return a&&a.map((a,t)=>s.createElement(a.tag,c({key:t},a.attr),e(a.child)))}(e.child))}function m(e){var a=a=>{var t,{attr:r,size:l,title:n}=e,d=function(e,a){if(null==e)return{};var t,s,r=function(e,a){if(null==e)return{};var t={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(a.indexOf(s)>=0)continue;t[s]=e[s]}return t}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(s=0;s<l.length;s++)t=l[s],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}(e,o),m=l||a.size||"1em";return a.className&&(t=a.className),e.className&&(t=(t?t+" ":"")+e.className),s.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,r,d,{className:t,style:c(c({color:e.color||a.color},a.style),e.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),n&&s.createElement("title",null,n),e.children)};return void 0!==l?s.createElement(l.Consumer,null,e=>a(e)):a(r)}}},e=>{var a=a=>e(e.s=a);e.O(0,[711,560,798,441,517,358],()=>a(46800)),_N_E=e.O()}]);